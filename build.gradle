plugins {
    id "maven-publish"
}

tasks.register("buildFfmpegKit") {
    group = "build"
    description = "Runs android.sh release to build ffmpeg-kit"

    doLast {
        exec {
            workingDir = projectDir
            commandLine("bash", "./android.sh", "--enable-gnutls --disable-x86 --disable-x86-64 --disable-arm-v7a --api-level=21")
        }
    }
}

publishing {
    publications {
        create<MavenPublication>("release") {
            groupId = "io.github.scovillo"
            artifactId = "ffmpeg-kit-android"
            version = project.version.toString()

            dependsOn(tasks["buildFfmpegKit"])
            artifact(fileTree("ffmpeg-kit/android/ffmpeg-kit-android-lib/build/outputs/aar").matching {
                include("*.aar")
            }.singleFile)
        }
    }
}
